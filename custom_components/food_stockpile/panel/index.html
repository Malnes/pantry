<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Food Stockpile</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script>
    // Home Assistant will inject an auth token in `document.querySelector("home-assistant")`
    // in a real custom panel youâ€™d typically rely on the WebSocket or from your main HA session.
    // For simplicity, we assume this page is served inside an iframe and can call /api/services via an existing session.

    async function callService(domain, service, data) {
      const response = await fetch(`/api/services/${domain}/${service}`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
      });
      if (!response.ok) {
        alert("Service call failed!");
      } else {
        alert("Service call succeeded!");
      }
    }

    function addItem() {
      const itemName = document.getElementById("add_item_name").value;
      const qty = parseInt(document.getElementById("add_item_quantity").value, 10);
      const expInput = document.getElementById("add_item_expiration").value.trim();
      const expDates = expInput ? expInput.split(",") : [];

      callService("food_stockpile", "add_item", {
        item_name: itemName,
        quantity: qty,
        expiration_dates: expDates
      });
    }

    function editItem() {
      const itemName = document.getElementById("edit_item_name").value;
      const minQty = parseInt(document.getElementById("edit_item_min_quantity").value, 10);
      callService("food_stockpile", "edit_item", {
        item_name: itemName,
        min_quantity: minQty
      });
    }

    function removeItem() {
      const itemName = document.getElementById("remove_item_name").value;
      const qty = parseInt(document.getElementById("remove_item_quantity").value, 10);
      const expInput = document.getElementById("remove_item_expiration").value.trim();
      const expDates = expInput ? expInput.split(",") : [];

      callService("food_stockpile", "remove_item", {
        item_name: itemName,
        quantity: qty,
        expiration_dates: expDates
      });
    }
  </script>
</head>
<body>
  <h1>Food Stockpile Management</h1>
  <div style="margin-bottom:20px;">
    <h2>Add Item</h2>
    <label>Name: <input id="add_item_name" type="text"></label><br>
    <label>Quantity: <input id="add_item_quantity" type="number" value="1"></label><br>
    <label>Expiration(s) (comma-separated YYYY-MM-DD):<br><textarea id="add_item_expiration"></textarea></label><br>
    <button onclick="addItem()">Add</button>
  </div>

  <div style="margin-bottom:20px;">
    <h2>Edit Item (Min Quantity)</h2>
    <label>Name: <input id="edit_item_name" type="text"></label><br>
    <label>Min Quantity: <input id="edit_item_min_quantity" type="number" value="1"></label><br>
    <button onclick="editItem()">Edit</button>
  </div>

  <div>
    <h2>Remove Item</h2>
    <label>Name: <input id="remove_item_name" type="text"></label><br>
    <label>Quantity: <input id="remove_item_quantity" type="number" value="1"></label><br>
    <label>Expiration(s) to remove (comma-separated):<br><textarea id="remove_item_expiration"></textarea></label><br>
    <button onclick="removeItem()">Remove</button>
  </div>
</body>
</html>
